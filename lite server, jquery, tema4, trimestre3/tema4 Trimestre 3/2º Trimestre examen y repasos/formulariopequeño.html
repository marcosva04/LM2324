<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practica Formulario Javascript</title>
    <style>
        .error{
            color: red;
        }
    </style>
</head>
<body onload="cargarDatos()">
    <label>Nombre:</label><input id="nombre" type="text" required><span class="error" id="campo1"></span><br><br>
    <label>Apellidos:</label><input id="apellidos" type="text" required><span class="error" id="campo2"></span><br><br>

    <label>Contraseña:</label><input id="password1" type="password" required><span class="error" id="campo3"></span><br><br>
    <label>Repite contraseña:</label><input id="password2" type="password" required><span class="error" id="campo4"></span><br><br>

    <label>Términos y condiciones:</label><input id="terminos" type="checkbox" required><span class="error" id="campo5"></span><br><br>

    <label>Pulse si desea guardar los datos</label><input id="verificacion" type="checkbox" value="off"><br><br>

    <button onclick="validar(document.getElementsByTagName('input'))">Validar</button>

    <button onclick="borrar()">Borrar registro</button>

    <script>
        function validar(elementos){
            let estanCorrectos = true;
            for (var i=0;i<elementos.length;i++){
                if (elementos[i].type !== "checkbox") {
                    document.getElementById("campo" + (i + 1)).innerHTML = ''; // Por defecto el campo está OK
                    if (elementos[i].value == "") {
                        document.getElementById("campo" + (i + 1)).innerHTML = "El campo " + elementos[i].id + " está vacío";
                        estanCorrectos = false;
                    }
                }
            }
            if(document.getElementById('terminos').checked){
                document.getElementById("campo5").innerHTML = "";
            }
            else{
                document.getElementById("campo5").innerHTML = "Debe aceptar términos y condiciones";
                estanCorrectos = false;
            }

            if (!validaPasswords()){ // Si no son válidas las contraseñas
                document.getElementById("campo3").innerHTML = "La contraseña no cumple con requisitos o no coinciden";
                document.getElementById("campo4").innerHTML = "La contraseña no cumple con requisitos o no coinciden";
                estanCorrectos = false;
            }
            if (estanCorrectos) {
                alert("Usuario registrado con éxito");
                if (document.getElementById('verificacion').checked) {
                    guardar();
                }
            }
            return estanCorrectos;
        }



        function validaPasswords(){
            let clave1 = document.getElementById("password1").value;
            let clave2 = document.getElementById("password2").value;
            let validPassword = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;
            return validPassword.test(clave1) && clave1 === clave2;
        }



        function guardar(){ // setItem para guardar lo que haya
            localStorage.setItem("nombre", document.getElementById("nombre").value);
            localStorage.setItem("apellidos", document.getElementById("apellidos").value);
            localStorage.setItem("password1", document.getElementById("password1").value);
            localStorage.setItem("password2", document.getElementById("password2").value);
            localStorage.setItem("terminos", document.getElementById("terminos").checked);

        }

        function cargarDatos(){ // getItem para restaurar lo que haya
            if (localStorage.getItem("nombre") && localStorage.getItem("apellidos")) {
                document.getElementById("nombre").value = localStorage.getItem("nombre");
                document.getElementById("apellidos").value = localStorage.getItem("apellidos");
                document.getElementById("password1").value = localStorage.getItem("password1");
                document.getElementById("password2").value = localStorage.getItem("password2");
                document.getElementById("terminos").checked = localStorage.getItem("terminos");
            }
        }

        function borrar(){
            localStorage.clear();
        }
    </script>
</body>
</html>